<div id="cursor-container">
  <div id="bunny" class="custom-element">
    <img id="bunnyimg" src="/assets/bunnyhops.png" alt="bunny" width=32>
  </div>
  <!-- <div id="carrot" class="custom-element">ðŸ¥•</div> -->
</div>

<style>
  /* Hide the default mouse cursor */
  /* body, a, button {
    cursor: none !important;
  } */

  #cursor-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allows clicking through the emojis */
    z-index: 9999;
  }

  .custom-element {
    position: fixed;
    font-size: 24px;
    user-select: none;
    line-height: 1;
  }

</style>

<script>
  //const carrot = document.getElementById('carrot');
  const bunny = document.getElementById('bunny');
  const bunnyimg = document.getElementById('bunnyimg')
  const bunnyHop = "/assets/bunnyhopfs.gif"
  const bunnyStill = "/assets/bunnyhops.png"
  // const bunnyHop = "/assets/bunnyhopping.gif"
  // const bunnyStill = "/assets/bunnystill.png"
  const hopDuration = 800; // Total loop time (8 frames * 100ms)
  const airStart = 100;    // Start moving at Frame 2
  const airEnd = 400;      // Stop moving at end of Frame 4

  let mouseX = parseFloat(sessionStorage.getItem('mouseX')) || 0;
  let mouseY = parseFloat(sessionStorage.getItem('mouseY')) || 0;
  let bunnyX = parseFloat(sessionStorage.getItem('bunnyX')) || 24;
  let bunnyY = parseFloat(sessionStorage.getItem('bunnyY')) || 24;
  const speed = 1.4; 

  window.addEventListener('beforeunload', () => {
    sessionStorage.setItem('mouseX', mouseX);
    sessionStorage.setItem('mouseY', mouseY);
    sessionStorage.setItem('bunnyX', bunnyX);
    sessionStorage.setItem('bunnyY', bunnyY);

  });

  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
    //carrot.style.left = (mouseX + 0) + 'px';
    //carrot.style.top = (mouseY - 24) + 'px';
  });

  let hopStartTime = 0;
  let isHopping = false;

  function animate() {
    const currentTime = Date.now();
    // Determine distance between bunny and carrot
    let dista = ((mouseX - bunnyX)**2 + (mouseY - bunnyY)**2)**0.5

    if (!isHopping){
      if (dista > 50){
        bunnyimg.src = bunnyHop;
        isHopping = true;
        hopStartTime = currentTime;
      }
    } else { // hopping
      let timeIntoHop = (currentTime - hopStartTime) % hopDuration;
      if (dista <= 50 && timeIntoHop > 500){
        isHopping = false;
        bunnyimg.src = bunnyStill;
      } 
      else {
        if (timeIntoHop >= airStart && timeIntoHop < airEnd){
          let dx = (mouseX - bunnyX)/dista;
          let dy = (mouseY - bunnyY)/dista;
          bunnyX += dx * speed;
          bunnyY += dy * speed;
        }
      }
    }

    if (mouseX - bunnyX > 0) {
      bunny.style.transform = "scaleX(-1)"; 
    } else {
      bunny.style.transform = "scaleX(1)";
    }

    bunny.style.left = (bunnyX + 0) + 'px'; 
    bunny.style.top = (bunnyY - 24) + 'px';

    requestAnimationFrame(animate);
  }

  animate();
</script>